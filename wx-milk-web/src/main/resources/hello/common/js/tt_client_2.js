$script.ready(['lib'], function() {"use strict";function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function(t,e,n){for(var i=!0;i;){var r=t,o=e,a=n;i=!1,null===r&&(r=Function.prototype);var s=Object.getOwnPropertyDescriptor(r,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;if(void 0===u)return;return u.call(a)}var c=Object.getPrototypeOf(r);if(null===c)return;t=c,e=o,n=a,i=!0,s=c=void 0}},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Command=function(){function t(e){_classCallCheck(this,t),this.defer=$.Deferred(),this.id=e.id}return _createClass(t,[{key:"resolve",value:function(){return this.defer.resolve(this)}},{key:"reject",value:function(){return this.defer.reject()}},{key:"stop",value:function(){}},{key:"promise",get:function(){return this.defer.promise()}}]),t}(),ClickCommand=function(t){function e(t){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t)}return _inherits(e,t),_createClass(e,[{key:"play",value:function(){var t=this;return tt.timelineResume(this,function(){t.paused?t.paused.promise().done(function(){t.resolve()}):t.resolve()}),this.promise}},{key:"pause",value:function(){this.paused=$.Deferred()}},{key:"resume",value:function(){this.paused.resolve()}}]),e}(Command),AudioCommand=function(t){function e(t){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.path=t.media_url,this.duration=t.duration}return _inherits(e,t),_createClass(e,[{key:"play",value:function(){return this.sound=tt.playVoice(this),this.promise}},{key:"stop",value:function(){this.sound&&this.sound.pause()}},{key:"pause",value:function(){tt.pauseVoice(this)}},{key:"resume",value:function(){tt.resumeVoice(this)}}]),e}(Command),commandMapping={click:ClickCommand,voice:AudioCommand},CommandCollection=function(){function t(e){_classCallCheck(this,t),this.data=e,this._c=1}return _createClass(t,[{key:"play",value:function(t){var e=this,n=t.onProgress;return this.playStopped=!1,this.actions.reduce(function(t,i){return t.done(function(t){return e.playStopped?void i.reject():(e.lastPlaying=i,i.play(),void n(i))}),i.promise},{done:function(t){setTimeout(t)}})}},{key:"stop",value:function(){this.playStopped=!0,this.lastPlaying&&(this.lastPlaying.stop(),this.lastPlaying.reject())}},{key:"pause",value:function(){this.lastPlaying&&this.lastPlaying.pause()}},{key:"resume",value:function(){this.lastPlaying&&this.lastPlaying.resume()}},{key:"reset",value:function(){var t=this;this._c+=1,this.actions=this.data.map(function(t){return new commandMapping[t.type](t)}).map(function(e){return e._c=t._c,e})}},{key:"preparePlay",value:function(){this.reset()}},{key:"renderProgress",value:function(){var t=this.actions.filter(function(t){return t.constructor==AudioCommand}),e=t.reduce(function(t,e){return t+e.duration},0),n=this.actions.length-t.length,i=Math.min(.02,.5/n),r=1-n*i;return this.actions.map(function(t){return t.constructor==AudioCommand?"<span class='audio-bar' id='item-"+t.id+"' style='width: "+t.duration/e*r*100+"%; animation-duration: "+t.duration+"s; -webkit-animation-duration: "+t.duration+"s'></span>":"<span class='click-bar' id='item-"+t.id+"' style='width: "+100*i+"%'></span>"}).join("")}}]),t}();
var introDefer=$.Deferred();$(document.body).on("complete",function(){});var TTCDN=window.CDN||"//v5.ppj.io";$("#intro").on("click",function(){var e=this,t=document.getElementById("track");t.pause(),t.src=TTCDN+"/common/silence.mp3?v=2";var n=function(){setTimeout(function(){$(e).fadeOut(function(){introDefer.resolve()}),t.removeEventListener("canplaythrough",n)})};t.addEventListener("canplaythrough",n),t.play(),tt.emit("startPlay")}),$(document.body).on("initSlide",function(e,t){tt.beforeInit(t)});var PLAY_EVENT=window.FEATURES&&FEATURES.lazyPlay?"playTimeline":"playSlide";$(document.body).on(PLAY_EVENT,function(e,t){introDefer.promise().done(function(){if(window.slides[t].window.main||window.slides[t].noPlay===!0)tt.initSlide(t);else var e=4,n=setInterval(function(){return!window.slides[t].window.main&&window.slides[t].noPlay!==!0&&e?void e--:(tt.initSlide(t),void clearInterval(n))},200)})}),$(document.body).on("beforeOnPause",function(e,t,n){return tt.slides[n]||tt.timelineResume(),!1}),$(document.body).on("slideComplete",function(e,t){return tt.isCurrentPageEmpty()?void 0:!1}),$(document.body).on("beforePlay",function(e,t){return introDefer.promise()}),window.tt=function(){var e;return{event:$({}),emit:function(){this.event.trigger.apply(this.event,arguments)},on:function(e,t){this.event.on(e,function(){t&&t.apply(void 0,Array.prototype.slice.call(arguments,1))})},one:function(e,t){this.event.one(e,function(){t&&t.apply(void 0,Array.prototype.slice.call(arguments,1))})},slides:e,init:function(t){this.slides=e=Object.keys(t.data).reduce(function(e,n){return e[n]=new CommandCollection(t.data[n]),e},{}),tt.emit("init",t)},beforeInit:function(e){var t=window.slides[e],n=t.transition||{};t.transition={effect:n.effect,duration:n.duration},this.isEmptyPage(this.slides[e])&&n.autoAdvance&&(t.transition.autoAdvance=n.autoAdvance)},isEmptyPage:function(e){return!e||0==(e.data||[]).filter(function(e){return"voice"==e.type}).length},isCurrentPageEmpty:function(){return this.isEmptyPage(this.currentPage)},initSlide:function(t){this.currentPage&&this.currentPage.stop(),tt.emit("initSlide",t);var n=e[t],i=this;return this.timeline=window.slides[t].window.main,this.slideBody=window.slides[t].slideBody,this.currentPage=n,$("#progress-bar").contents().remove(),n?($("#play-btn").show(),n.preparePlay(),$("#progress-bar").append(n.renderProgress()),void n.play({onProgress:function(e){$("#item-"+e.id).addClass("playing")}}).done(function(){i.isCurrentPageEmpty()||frame.nextSlide(t)})):void $("#play-btn").hide()},timelineResume:function(e,t){console.log("timeline resume");var n=this.timeline;if(!n)return t&&t(),!1;if(n.paused())n.resume2(),t&&t();else{if(window.FEATURES&&FEATURES.lazyPlay&&!n._hasPausedChild())return n.resume2(),void(t&&t());$(document.body).one("beforeOnPause",function(e,i,o){return n.resume2(),t&&t(),!1})}},playVoice:function(e){if(!e.path)return e.resolve(),console.error("empty path",e),t;console.log("play voice!!!");var t=document.getElementById("track"),n=[TTCDN.replace(/\/$/,""),e.path.replace(/^\//,"")].join("/");return t.pause(),t.src=n,t.play(),$(t).one("ended error",function(){-1!=t.src.indexOf(n)&&(console.log("ended"),e.resolve())}),t},pauseVoice:function(e){var t=document.getElementById("track");t.pause(),$("#item-"+e.id).addClass("paused")},resumeVoice:function(e){var t=document.getElementById("track");t.play(),$("#item-"+e.id).removeClass("paused")},getIndex:function(){return-1}}}(),tt.on("init",function(e){e.lecturer_info.show_author?($("#lecturer-avatar").append($("<img src="+e.lecturer_info.headimgurl+">")),$("#lecturer-name").text(e.lecturer_info.nickname)):($("#lecture-info").css({"border-spacing":"0"}),$("#intro").addClass("for-21tb")),$("#lecture-title").text(window.wxConfig.shareObj.title),$("#lecture-description").text(window.wxConfig.shareObj.desc)}),tt.on("startPlay",function(){for(var e=window.slides.length,t=$("<div>"),n=0;e>=n;n++)t.append("<li class='page-ref' data-index='"+(n+1)+"'></li>");var i=$("#toc ul");i.contents().remove(),i.append(t.contents())}),tt.on("pause",function(e){e?tt.currentPage.pause():tt.currentPage.resume()}),tt.on("initSlide",function(e){$("#edit-info").attr("data-total",window.slides.length).attr("data-current",e+1).addClass("ff").removeClass("ff")}),$("#edit-info").on("click",function(){$("#toc").css("display","block");var e=$("#toc ul")[0];e.offsetHeight<e.scrollHeight&&$(e).addClass("with-scroller"),setTimeout(function(){$("#toc").removeClass("hidden")},200)}),$(".scroller").on("click",function(e){var t=$($.attr(this,"target"))[0],n=$(e.target).hasClass("prev")?-1:1;t.scrollTop=t.scrollTop+n*t.offsetHeight,e.stopPropagation(),e.preventDefault()}),$("#toc").on("click",function(e){$("#toc").addClass("hidden").css("display","none")}),$("#toc").on("click",".page-ref",function(){var e=$.attr(this,"data-index");frame.jumpSlide(parseInt(e)-1)}),tt.on("initSlide",function(e){$("#play-btn").removeClass("paused")}),$("#play-btn").on("click",function(){$(this).hasClass("paused")?(tt.emit("pause",!1),$(this).removeClass("paused")):(tt.emit("pause",!0),$(this).addClass("paused"))}),$("#loading.default-logo").length&&$("#intro").append("<div id='footnote'>PPåŒ  ppj.io</div>");})